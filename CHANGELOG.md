# 版本历史

## v2.0.3 (2026-01-16) 🔧

### 功能优化
- **摘要生成优化**: 修复摘要内容不准确的问题
  - 新增 `extract_text_from_html()` 函数，从 HTML 中提取纯文本
  - 优化摘要生成 prompt，要求提炼新闻亮点、语言简洁有力
  - 增加摘要生成日志便于追踪
  - 影响文件: `auto_daily_news.py`

### 技术细节
- 摘要生成前先移除 HTML 标签，确保 AI 能正确理解新闻内容
- 摘要长度控制在 20-30 字，突出 1-2 个新闻亮点

---

## v2.0.2 (2026-01-15) 🐛

### Bug 修复
- **GitHub Actions 执行失败修复**: 修复自动化任务执行失败问题
  - 添加发布失败时的错误退出码 (sys.exit(1))
  - 改进 subprocess 错误处理，添加详细日志记录
  - 修复 rss_news_collector.py 文件路径问题，使用相对路径
  - 添加文件存在性检查和内容验证
  - 添加超时和异常类型的详细处理
  - 影响文件: `auto_daily_news.py`, `rss_news_collector.py`

- **农历日期显示修复**: 修复农历日期显示错误并改用传统格式
  - 修复农历日期显示错误（之前显示十二月初五，实际应为十一月廿七）
  - 改用传统农历日期格式：乙巳年冬月廿七
  - 添加 get_traditional_lunar_date() 函数
  - 使用天干地支年份 + 传统月份（冬月/腊月）+ 传统日期（廿七）
  - 影响文件: `auto_daily_news.py`, `rss_news_collector.py`

### 技术细节
- 农历日期格式: "乙巳年冬月廿七"（传统格式）
- 错误处理: 完整的异常捕获和日志记录
- 定时任务: 调整为 UTC 00:30（北京时间 08:30）

---

## v2.0.1 (2026-01-15) 🐛

### Bug 修复
- **农历日期修复**: 使用 zhdate 库获取真实农历日期
  - 修复硬编码"乙巳年"的问题，现在动态获取正确的农历年份
  - 修复使用公历月日代替农历月日的问题
  - 影响文件: `auto_daily_news.py`, `test_date_logic.py`, `rss_news_collector.py`
- **依赖更新**: 在 GitHub Actions 中添加 zhdate 库依赖
  - 确保自动化任务中农历日期功能正常工作

### 技术细节
- 新增依赖: `zhdate==0.1`
- 农历日期格式: "二零二五年十一月二十七"（示例）
- 自动适配年份变化，无需手动更新

---

## v2.0.0 (2026-01-14) 🚀

### 核心功能重构
- **RSS 真实新闻源**: 替换 AI 生成，使用 12+ 权威 RSS 源收集真实新闻
  - 量子位、机器之心、36氪、虎嗅、钛媒体、爱范儿
  - TechCrunch、The Verge、Bloomberg、华尔街见闻
- **精准日期过滤**: 确保只收集昨天一整天的新闻（00:00:00 - 23:59:59）
- **AI 智能分类**: 使用豆包 API 将新闻智能分类到 3 个类别
- **去重机制**: 基于标题的智能去重，避免重复内容

### 安全性修复
- **移除硬编码 API key**: 所有文件中的 API key 已移除
- **环境变量验证**: 添加启动时的环境变量检查
- **文档安全**: 所有示例使用占位符而非真实 key

### HTML 模板优化
- **渐变标签设计**: 三个分类使用不同渐变色（紫色/粉红/蓝色）
- **日期卡片**: 粉绿渐变背景，显示农历/星期/公历
- **微语卡片**: 粉黄渐变背景，AI 生成励志语录
- **编号系统**: 每条新闻带彩色编号（01-05）
- **移除冗余**: 去除标题重复和多余的"以下是..."字样

### 部署优化
- **GitHub Actions**: 每天 08:00 自动运行（UTC 00:00）
- **本地任务清理**: 删除本地 launchd 任务，避免重复执行
- **日志系统**: 完整的运行日志记录

### 文件结构
- **新增**: `rss_news_collector.py` - RSS 新闻收集脚本
- **新增**: `CHANGELOG.md` - 版本历史记录
- **优化**: `SKILL.md` - 更新为 V2.0.0

---

## v1.0.0 (2026-01-12)
- 初始版本
- 基于 WebSearch 的新闻收集
- 基础 HTML 格式化
- 公众号发布功能
